# Stream Processor default configuration
# These can be overridden by the consuming application

# Disabled by default - consumer must explicitly enable
stream-processor.enabled=false

# Dev profile - enable stream processor
%dev.stream-processor.enabled=true

# MongoDB database (shared by all streams)
stream-processor.database=flowcatalyst

# =============================================================================
# Events Stream Configuration
# =============================================================================
stream-processor.streams.events.enabled=true
stream-processor.streams.events.source-collection=events
stream-processor.streams.events.projection-collection=events_read
stream-processor.streams.events.mapper=events
stream-processor.streams.events.checkpoint-key=events-stream-checkpoint
stream-processor.streams.events.watch-operations=insert
stream-processor.streams.events.concurrency=10
stream-processor.streams.events.batch-max-size=100
stream-processor.streams.events.batch-max-wait-ms=100
# Aggregate ID field for ordering guarantees (same aggregate never in concurrent batches)
stream-processor.streams.events.aggregate-id-field=_id

# =============================================================================
# Dispatch Jobs Stream Configuration
# =============================================================================
stream-processor.streams.dispatch-jobs.enabled=true
stream-processor.streams.dispatch-jobs.source-collection=dispatch_jobs
stream-processor.streams.dispatch-jobs.projection-collection=dispatch_jobs_read
stream-processor.streams.dispatch-jobs.mapper=dispatch-jobs
stream-processor.streams.dispatch-jobs.checkpoint-key=dispatch-jobs-stream-checkpoint
stream-processor.streams.dispatch-jobs.watch-operations=insert,update
stream-processor.streams.dispatch-jobs.concurrency=5
stream-processor.streams.dispatch-jobs.batch-max-size=50
stream-processor.streams.dispatch-jobs.batch-max-wait-ms=100
# Aggregate ID field for ordering guarantees (same aggregate never in concurrent batches)
stream-processor.streams.dispatch-jobs.aggregate-id-field=_id

# =============================================================================
# Hot Standby Configuration (disabled by default)
# =============================================================================
standby.enabled=false
standby.lock-key=stream-processor-primary-lock
standby.lock-ttl-seconds=30

# =============================================================================
# Logging Configuration
# =============================================================================
# Dev profile - readable logs (not JSON)
%dev.quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
%dev.quarkus.log.console.json.enabled=false
%dev.quarkus.log.level=INFO
%dev.quarkus.log.category."tech.flowcatalyst".level=DEBUG

# =============================================================================
# MongoDB Connection
# =============================================================================
quarkus.mongodb.connection-string=${MONGODB_URL:mongodb://localhost:27017}
quarkus.mongodb.database=${MONGODB_DATABASE:flowcatalyst}
%dev.quarkus.mongodb.connection-string=mongodb://localhost:27017/?replicaSet=rs0&directConnection=true
%dev.quarkus.mongodb.database=flowcatalyst
# Disable Dev Services - use the docker-compose MongoDB
quarkus.mongodb.devservices.enabled=false
